<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAFALTA EXPRESS | SECURE NEXUS</title>
    
    <!-- PWA Config -->
    <meta name="theme-color" content="#020617">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlNhZmFsdGEgRXhwcmVzcyIsCiAgInNob3J0X25hbWUiOiAiU2FmYWx0YUV4cCIsCiAgInN0YXJ0X3VybCI6ICIuIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjMDIwNjE3IiwKICAidGhlbWVfY29sb3IiOiAiIzAyMDYxNyIKfQ==">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@700&family=Space+Grotesk:wght@300;400;700&family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        :root { --blue: #00d2ff; --purple: #bc13fe; --gold: #ffcc33; --dark: #020617; --danger: #ef4444; --success: #22c55e; }
        body { background: var(--dark); color: white; font-family: 'Space Grotesk', sans-serif; overflow-x: hidden; scroll-behavior: smooth; }
        .font-nexus { font-family: 'Orbitron', sans-serif; }
        .font-titan { font-family: 'Syncopate', sans-serif; }
        
        .glass { background: rgba(255,255,255,0.03); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.08); box-shadow: 0 4px 30px rgba(0,0,0,0.5); }
        .glass-panel { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255,255,255,0.1); }
        
        .neon-text { text-shadow: 0 0 10px var(--blue); }
        .status-badge { padding: 4px 12px; border-radius: 999px; font-weight: 800; text-transform: uppercase; font-size: 10px; letter-spacing: 1px; }
        .status-pending { background: rgba(234, 179, 8, 0.2); color: #fbbf24; border: 1px solid #fbbf24; }
        .status-active { background: rgba(34, 197, 94, 0.2); color: #4ade80; border: 1px solid #4ade80; }
        .status-banned { background: rgba(239, 68, 68, 0.2); color: #f87171; border: 1px solid #f87171; }

        .reveal { opacity: 0; transform: translateY(20px); transition: 0.8s cubic-bezier(0.2, 0.8, 0.2, 1); }
        .reveal.active { opacity: 1; transform: translateY(0); }
        
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        
        /* Loading Spinner */
        .loader { border: 3px solid rgba(255,255,255,0.1); border-left-color: var(--blue); border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .gemini-gradient { background: linear-gradient(135deg, #4285F4, #9B72CB, #D96570); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>

    <script type="importmap">
        {
            "imports": {
                "react": "https://esm.sh/react@18.2.0",
                "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
                "lucide-react": "https://esm.sh/lucide-react@0.344.0?external=react",
                "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
                "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js",
                "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"
            }
        }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import ReactDOM from 'react-dom/client';
        import { 
            Zap, Home, LayoutDashboard, LogOut, Menu, X, Brain, Send, 
            MessageSquare, MapPin, Phone, CheckCircle, ShieldCheck, 
            AlertTriangle, CreditCard, Users, Search, Lock, Edit3, Trash2,
            Sparkles, Calendar, PenTool, FileText, User // Added User here
        } from 'lucide-react';
        import { initializeApp } from "firebase/app";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "firebase/auth";
        import { getFirestore, doc, setDoc, getDoc, collection, onSnapshot, query, orderBy, addDoc, updateDoc, serverTimestamp, deleteDoc } from "firebase/firestore";

        // --- CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyBbwul_dbciJX3SQIVFQqXktmCsCghJRHU",
            authDomain: "safalta-express-boys-hostel.firebaseapp.com",
            projectId: "safalta-express-boys-hostel",
            storageBucket: "safalta-express-boys-hostel.firebasestorage.app",
            messagingSenderId: "943963131070",
            appId: "1:943963131070:web:48db2233c27d7ae15562ef"
        };
        
        // ðŸš¨ SECURITY NOTE: In production, move keys to backend.
        const GROQ_API_KEY = "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"; 
        const GEMINI_API_KEY = ""; // Environment provided
        
        const OWNER_EMAIL = "riteshs9122@gmail.com";
        const APP_ID = "safalta-secure-v1";

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        // --- GEMINI API HELPER ---
        const callGemini = async (prompt) => {
            const apiKey = ""; // API Key provided by environment at runtime
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "Connectivity Error. Try again.";
            } catch (error) {
                console.error(error);
                return "Gemini System Offline.";
            }
        };

        // --- COMPONENTS ---

        const GeminiTools = () => {
            const [tool, setTool] = useState('planner'); // planner | drafter
            const [input, setInput] = useState('');
            const [result, setResult] = useState('');
            const [loading, setLoading] = useState(false);

            const handleGenerate = async () => {
                if (!input) return;
                setLoading(true);
                let prompt = "";
                
                if (tool === 'planner') {
                    prompt = `Create a strict, high-performance daily study schedule for a student living in a hostel. The student is preparing for: ${input}. Include breaks for meals (Mess times: 8:30am, 1:00pm, 8:00pm). Format nicely with emojis.`;
                } else {
                    prompt = `Write a formal and polite application/email for a hostel student. Context/Reason: ${input}. Address it to the Hostel Warden, Safalta Express. Keep it professional.`;
                }

                const res = await callGemini(prompt);
                setResult(res);
                setLoading(false);
            };

            return React.createElement('div', { className: "max-w-4xl mx-auto space-y-8 animate-in fade-in" },
                React.createElement('div', { className: "text-center" },
                    React.createElement('h2', { className: "text-3xl font-titan mb-2 flex justify-center items-center gap-3" }, 
                        React.createElement(Sparkles, { className: "text-purple-400" }), 
                        React.createElement('span', { className: "gemini-gradient" }, "GEMINI POWER TOOLS")
                    ),
                    React.createElement('p', { className: "text-gray-400" }, "Next-Gen AI tools to automate your student life.")
                ),

                React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                    React.createElement('button', { 
                        onClick: () => { setTool('planner'); setResult(''); },
                        className: `p-4 rounded-2xl flex flex-col items-center gap-2 transition border ${tool === 'planner' ? 'bg-purple-600/20 border-purple-500' : 'glass border-transparent hover:bg-white/5'}`
                    }, React.createElement(Calendar, { className: "text-purple-400" }), "Study Architect"),
                    
                    React.createElement('button', { 
                        onClick: () => { setTool('drafter'); setResult(''); },
                        className: `p-4 rounded-2xl flex flex-col items-center gap-2 transition border ${tool === 'drafter' ? 'bg-blue-600/20 border-blue-500' : 'glass border-transparent hover:bg-white/5'}`
                    }, React.createElement(PenTool, { className: "text-blue-400" }), "Smart Drafter")
                ),

                React.createElement('div', { className: "glass p-8 rounded-3xl" },
                    React.createElement('h3', { className: "text-xl font-bold mb-4" }, tool === 'planner' ? "Design Your Success Roadmap" : "Draft Professional Applications"),
                    
                    React.createElement('textarea', {
                        value: input,
                        onChange: (e) => setInput(e.target.value),
                        placeholder: tool === 'planner' ? "e.g., JEE Mains, Weak in Physics, need 10 hours study..." : "e.g., Going home for sister's wedding for 5 days...",
                        className: "w-full bg-black/30 border border-white/10 rounded-xl p-4 min-h-[100px] outline-none focus:border-purple-500 transition mb-4"
                    }),

                    React.createElement('button', {
                        onClick: handleGenerate,
                        disabled: loading,
                        className: "w-full bg-gradient-to-r from-blue-600 to-purple-600 py-3 rounded-xl font-bold flex justify-center items-center gap-2 hover:scale-[1.01] transition"
                    }, loading ? React.createElement('div', { className: "loader" }) : React.createElement(Sparkles, { size: 18 }), "GENERATE WITH GEMINI"),

                    result && React.createElement('div', { className: "mt-8 bg-black/40 p-6 rounded-2xl border border-white/10 animate-in slide-in-from-bottom-4" },
                        React.createElement('div', { className: "flex justify-between items-center mb-4" },
                            React.createElement('h4', { className: "text-sm font-bold text-gray-400 uppercase tracking-widest" }, "AI Output"),
                            React.createElement('button', { 
                                onClick: () => { navigator.clipboard.writeText(result); alert('Copied!'); },
                                className: "text-xs text-blue-400 hover:text-white"
                            }, "COPY TEXT")
                        ),
                        React.createElement('div', { className: "whitespace-pre-wrap leading-relaxed text-sm" }, result)
                    )
                )
            );
        };

        const AdminPanel = ({ users, config, onUpdateConfig, onVerifyUser, onBanUser }) => {
            const [searchTerm, setSearchTerm] = useState("");
            const [editPrice, setEditPrice] = useState(config?.price || 4000);

            const filteredUsers = users.filter(u => u.name?.toLowerCase().includes(searchTerm.toLowerCase()) || u.email?.toLowerCase().includes(searchTerm.toLowerCase()));

            return React.createElement('div', { className: "space-y-8 animate-in fade-in" },
                // Stats Row
                React.createElement('div', { className: "grid grid-cols-2 md:grid-cols-4 gap-4" },
                    [{ l: "Total Users", v: users.length, c: "text-blue-400" },
                     { l: "Active Residents", v: users.filter(u => u.status === 'Active').length, c: "text-green-400" },
                     { l: "Pending Verification", v: users.filter(u => u.status === 'Pending').length, c: "text-yellow-400" },
                     { l: "Monthly Revenue", v: `â‚¹${users.filter(u => u.status === 'Active').length * config.price}`, c: "text-purple-400" }
                    ].map((s, i) => React.createElement('div', { key: i, className: "glass p-6 rounded-2xl" },
                        React.createElement('p', { className: "text-xs text-gray-500 font-bold uppercase" }, s.l),
                        React.createElement('p', { className: `text-2xl font-black ${s.c}` }, s.v)
                    ))
                ),

                // Config Control
                React.createElement('div', { className: "glass p-6 rounded-3xl border-l-4 border-purple-500" },
                    React.createElement('h3', { className: "font-bold text-lg mb-4 flex items-center gap-2" }, React.createElement(Edit3, { size: 18 }), "Global Settings"),
                    React.createElement('div', { className: "flex gap-4 items-end" },
                        React.createElement('div', { className: "flex-1" },
                            React.createElement('label', { className: "text-xs text-gray-400 uppercase font-bold" }, "Monthly Rent (â‚¹)"),
                            React.createElement('input', { 
                                type: "number", 
                                value: editPrice, 
                                onChange: (e) => setEditPrice(e.target.value),
                                className: "w-full bg-black/40 border border-white/10 rounded-xl p-3 mt-1 outline-none focus:border-purple-500"
                            })
                        ),
                        React.createElement('button', { 
                            onClick: () => onUpdateConfig({ price: Number(editPrice) }),
                            className: "bg-purple-600 px-6 py-3 rounded-xl font-bold hover:bg-purple-500 transition"
                        }, "Update Rent")
                    )
                ),

                // User Management
                React.createElement('div', { className: "glass p-6 rounded-3xl" },
                    React.createElement('div', { className: "flex justify-between items-center mb-6" },
                        React.createElement('h3', { className: "font-bold text-lg" }, "Resident Database"),
                        React.createElement('div', { className: "flex items-center gap-2 bg-black/40 px-3 py-2 rounded-lg border border-white/10" },
                            React.createElement(Search, { size: 16, className: "text-gray-500" }),
                            React.createElement('input', { 
                                placeholder: "Search Name/Email...", 
                                value: searchTerm,
                                onChange: (e) => setSearchTerm(e.target.value),
                                className: "bg-transparent outline-none text-sm w-40 md:w-64"
                            })
                        )
                    ),
                    React.createElement('div', { className: "overflow-x-auto" },
                        React.createElement('table', { className: "w-full text-left border-collapse" },
                            React.createElement('thead', null,
                                React.createElement('tr', { className: "text-xs text-gray-500 uppercase border-b border-white/5" },
                                    ['User', 'Status', 'Payment Info', 'Joined', 'Actions'].map(h => React.createElement('th', { key: h, className: "p-3 font-bold" }, h))
                                )
                            ),
                            React.createElement('tbody', { className: "text-sm" },
                                filteredUsers.map(u => React.createElement('tr', { key: u.id, className: "border-b border-white/5 hover:bg-white/5 transition" },
                                    React.createElement('td', { className: "p-3" },
                                        React.createElement('div', { className: "flex items-center gap-3" },
                                            React.createElement('img', { src: u.photo || `https://ui-avatars.com/api/?name=${u.name}`, className: "w-8 h-8 rounded-full" }),
                                            React.createElement('div', null,
                                                React.createElement('p', { className: "font-bold" }, u.name),
                                                React.createElement('p', { className: "text-xs text-gray-500" }, u.email)
                                            )
                                        )
                                    ),
                                    React.createElement('td', { className: "p-3" },
                                        React.createElement('span', { className: `status-badge ${u.status === 'Active' ? 'status-active' : u.status === 'Pending' ? 'status-pending' : 'status-banned'}` }, u.status)
                                    ),
                                    React.createElement('td', { className: "p-3" },
                                        React.createElement('p', { className: "font-mono text-xs text-blue-300" }, u.txnId || 'N/A'),
                                        React.createElement('p', { className: "text-[10px] text-gray-500" }, u.paymentStatus || 'Unpaid')
                                    ),
                                    React.createElement('td', { className: "p-3 text-gray-400" }, new Date(u.joinedOn).toLocaleDateString()),
                                    React.createElement('td', { className: "p-3 flex gap-2" },
                                        u.status !== 'Active' && React.createElement('button', { onClick: () => onVerifyUser(u.id), className: "bg-green-600 p-2 rounded-lg hover:bg-green-500", title: "Verify & Activate" }, React.createElement(CheckCircle, { size: 16 })),
                                        React.createElement('button', { onClick: () => onBanUser(u.id), className: "bg-red-600/20 text-red-500 p-2 rounded-lg hover:bg-red-600 hover:text-white", title: "Revoke Access" }, React.createElement(Trash2, { size: 16 }))
                                    )
                                ))
                            )
                        )
                    )
                )
            );
        };

        const App = () => {
            // State
            const [user, setUser] = useState(null);
            const [profile, setProfile] = useState(null);
            const [activeTab, setActiveTab] = useState('hero');
            const [usersList, setUsersList] = useState([]);
            const [config, setConfig] = useState({ price: 4000 });
            
            // Payment Flow State
            const [txnId, setTxnId] = useState("");
            const [isVerifying, setIsVerifying] = useState(false);

            // AI State
            const [aiPrompt, setAiPrompt] = useState("");
            const [aiResponse, setAiResponse] = useState("");
            const [aiLoading, setAiLoading] = useState(false);
            const [aiCooldown, setAiCooldown] = useState(false);

            // Chat State
            const [chatMsg, setChatMsg] = useState("");
            const [messages, setMessages] = useState([]);

            // --- INITIALIZATION ---
            useEffect(() => {
                const unsubAuth = onAuthStateChanged(auth, async (u) => {
                    if (u) {
                        setUser(u);
                        const userRef = doc(db, 'artifacts', APP_ID, 'users', u.uid);
                        // Realtime Profile Listener
                        onSnapshot(userRef, (docSnap) => {
                            if (docSnap.exists()) {
                                setProfile(docSnap.data());
                            } else {
                                // First time login setup
                                const newProfile = { 
                                    name: u.displayName, 
                                    email: u.email, 
                                    photo: u.photoURL, 
                                    status: 'Pending', 
                                    paymentStatus: 'Unpaid',
                                    joinedOn: new Date().toISOString() 
                                };
                                setDoc(userRef, newProfile);
                                setProfile(newProfile);
                            }
                        });

                        // If Admin, fetch all users
                        if (u.email === OWNER_EMAIL) {
                            onSnapshot(collection(db, 'artifacts', APP_ID, 'users'), (snap) => {
                                setUsersList(snap.docs.map(d => ({ id: d.id, ...d.data() })));
                            });
                        }
                    } else {
                        setUser(null);
                        setProfile(null);
                    }
                });

                // Global Config
                onSnapshot(doc(db, 'artifacts', APP_ID, 'public', 'config'), (snap) => {
                    if (snap.exists()) setConfig(snap.data());
                    else setDoc(doc(db, 'artifacts', APP_ID, 'public', 'config'), { price: 4000 });
                });

                // Chat
                const qChat = query(collection(db, 'artifacts', APP_ID, 'public', 'data', 'chat'), orderBy('timestamp', 'desc'), limit(50));
                onSnapshot(qChat, (snap) => {
                    setMessages(snap.docs.map(d => ({ id: d.id, ...d.data() })));
                });

                // Scroll Reveal
                const obs = new IntersectionObserver(e => e.forEach(x => x.isIntersecting && x.target.classList.add('active')), {threshold: 0.1});
                document.querySelectorAll('.reveal').forEach(x => obs.observe(x));

                return () => unsubAuth();
            }, []);

            // --- FUNCTIONS ---

            const handleLogin = async () => {
                try { await signInWithPopup(auth, googleProvider); } catch(e) { console.error(e); }
            };

            const submitPayment = async () => {
                if (!txnId.trim()) return alert("Enter Transaction ID");
                setIsVerifying(true);
                // Update User Profile with Pending Payment
                await updateDoc(doc(db, 'artifacts', APP_ID, 'users', user.uid), {
                    txnId: txnId,
                    paymentStatus: 'Verifying',
                    paymentDate: new Date().toISOString()
                });
                alert("Payment Proof Submitted! Admin will verify shortly.");
                setIsVerifying(false);
            };

            const adminVerifyUser = async (uid) => {
                if (confirm("Confirm payment received and activate user?")) {
                    await updateDoc(doc(db, 'artifacts', APP_ID, 'users', uid), {
                        status: 'Active',
                        paymentStatus: 'Paid',
                        room: 'Assigned'
                    });
                }
            };

            const adminBanUser = async (uid) => {
                if (confirm("Revoke access for this user?")) {
                    await updateDoc(doc(db, 'artifacts', APP_ID, 'users', uid), { status: 'Banned' });
                }
            };

            const updateGlobalConfig = async (newConfig) => {
                await updateDoc(doc(db, 'artifacts', APP_ID, 'public', 'config'), newConfig);
                alert("Settings Updated");
            };

            const askAi = async () => {
                if (!aiPrompt.trim()) return;
                if (aiCooldown) return alert("Please wait 10 seconds between questions.");
                
                setAiLoading(true);
                setAiCooldown(true);
                setTimeout(() => setAiCooldown(false), 10000); // 10s Rate Limit

                try {
                    const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                        method: "POST",
                        headers: { "Authorization": `Bearer ${GROQ_API_KEY}`, "Content-Type": "application/json" },
                        body: JSON.stringify({
                            model: "llama3-8b-8192",
                            messages: [
                                { role: "system", content: "You are an AI Tutor for students. Be concise, helpful, and academic." },
                                { role: "user", content: aiPrompt }
                            ]
                        })
                    });
                    const data = await res.json();
                    setAiResponse(data.choices[0].message.content);
                } catch (e) { setAiResponse("Service overloaded. Try again later."); }
                setAiLoading(false);
            };

            const sendChat = async () => {
                if (!chatMsg.trim()) return;
                await addDoc(collection(db, 'artifacts', APP_ID, 'public', 'data', 'chat'), {
                    uid: user.uid, name: user.displayName, photo: user.photoURL, text: chatMsg, timestamp: serverTimestamp()
                });
                setChatMsg("");
            };

            // --- VIEW ---
            return React.createElement('div', { className: "min-h-screen text-white" },
                /* Navbar */
                React.createElement('nav', { className: "fixed top-0 w-full z-50 glass-panel px-6 py-3 flex justify-between items-center" },
                    React.createElement('div', { className: "flex items-center gap-2 cursor-pointer", onClick: () => setActiveTab('hero') },
                        React.createElement(ShieldCheck, { className: "text-blue-500" }),
                        React.createElement('div', null,
                            React.createElement('h1', { className: "font-titan text-lg" }, "SAFALTA", React.createElement('span', { className: "text-blue-500" }, "FORTRESS")),
                            React.createElement('p', { className: "text-[8px] tracking-widest text-gray-500 uppercase" }, "Secure Student Nexus")
                        )
                    ),
                    React.createElement('div', { className: "flex items-center gap-6" },
                        user ? React.createElement('div', { className: "flex items-center gap-3" },
                            React.createElement('button', { onClick: () => setActiveTab('gemini'), className: `hidden md:flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold transition ${activeTab === 'gemini' ? 'bg-purple-600' : 'bg-white/5 hover:bg-white/10'}` },
                                React.createElement(Sparkles, { size: 14 }), "GEMINI TOOLS"
                            ),
                            React.createElement('button', { onClick: () => setActiveTab('dashboard'), className: `flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold transition ${activeTab === 'dashboard' ? 'bg-blue-600' : 'bg-white/5 hover:bg-white/10'}` },
                                React.createElement(LayoutDashboard, { size: 14 }), "DASHBOARD"
                            ),
                            React.createElement('img', { src: user.photoURL, className: "w-8 h-8 rounded-full border border-gray-600" })
                        ) : React.createElement('button', { onClick: handleLogin, className: "bg-white text-black px-6 py-2 rounded-full text-xs font-black hover:scale-105 transition" }, "LOGIN")
                    )
                ),

                /* Main Content Area */
                React.createElement('main', { className: "pt-24 px-4 pb-20 max-w-7xl mx-auto" },
                    activeTab === 'hero' ? (
                        /* HERO & PUBLIC FEATURES */
                        React.createElement('div', { className: "space-y-20" },
                            // Hero Banner
                            React.createElement('section', { className: "text-center py-20 relative" },
                                React.createElement('div', { className: "absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[500px] h-[500px] bg-blue-600/20 rounded-full blur-[120px] -z-10" }),
                                React.createElement('h1', { className: "font-titan text-5xl md:text-8xl mb-6" }, "ELITE", React.createElement('br'), "LIVING"),
                                React.createElement('p', { className: "text-xl text-gray-400 max-w-2xl mx-auto mb-10" }, "Secure. Smart. Success-Driven. The only AI-Integrated Hostel in Begusarai."),
                                React.createElement('div', { className: "flex justify-center gap-4" },
                                    React.createElement('button', { onClick: () => setActiveTab('gemini'), className: "bg-purple-600 px-8 py-4 rounded-xl font-bold shadow-lg shadow-purple-500/30 hover:scale-105 transition flex items-center gap-2" }, React.createElement(Sparkles, {size:18}), "USE GEMINI TOOLS"),
                                    React.createElement('button', { onClick: () => setActiveTab('dashboard'), className: "glass px-8 py-4 rounded-xl font-bold hover:bg-white/5 transition" }, "BOOK MY SEAT")
                                )
                            ),

                            // Features Grid
                            React.createElement('div', { className: "grid md:grid-cols-3 gap-6" },
                                [
                                    { t: "Verified Residents", d: "Strict ID check & Admin approval.", i: User },
                                    { t: "Secure Payments", d: "Manual Verification for 100% safety.", i: Lock },
                                    { t: "AI Integration", d: "Personal Tutor & Planner.", i: Brain }
                                ].map((f, i) => React.createElement('div', { key: i, className: "glass p-8 rounded-3xl hover:border-blue-500/30 transition" },
                                    React.createElement(f.i, { className: "text-blue-500 mb-4", size: 32 }),
                                    React.createElement('h3', { className: "font-bold text-xl mb-2" }, f.t),
                                    React.createElement('p', { className: "text-gray-400 text-sm" }, f.d)
                                ))
                            )
                        )
                    ) : activeTab === 'gemini' ? (
                        /* GEMINI TOOLS SECTION */
                        React.createElement(GeminiTools)
                    ) : activeTab === 'ai' ? (
                        /* AI SECTION */
                        React.createElement('div', { className: "max-w-3xl mx-auto" },
                            React.createElement('h2', { className: "font-titan text-3xl mb-8 text-center" }, "AI TUTOR"),
                            React.createElement('div', { className: "glass p-6 rounded-3xl min-h-[400px] flex flex-col" },
                                React.createElement('div', { className: "flex-1 overflow-y-auto mb-6 space-y-4" },
                                    aiResponse ? React.createElement('div', { className: "bg-blue-600/20 p-6 rounded-2xl border border-blue-500/20" },
                                        React.createElement('p', { className: "text-blue-300 text-xs font-bold uppercase mb-2" }, "AI Response"),
                                        React.createElement('p', { className: "leading-relaxed whitespace-pre-wrap" }, aiResponse)
                                    ) : React.createElement('div', { className: "text-center text-gray-500 mt-20" },
                                        React.createElement(Brain, { className: "mx-auto mb-4 opacity-20", size: 64 }),
                                        React.createElement('p', null, "Ask me anything about Physics, Math, or Begusarai.")
                                    )
                                ),
                                React.createElement('div', { className: "flex gap-3" },
                                    React.createElement('input', { 
                                        value: aiPrompt,
                                        onChange: (e) => setAiPrompt(e.target.value),
                                        placeholder: aiCooldown ? "Cooling down..." : "Ask your doubt...",
                                        disabled: aiCooldown || aiLoading,
                                        className: "flex-1 bg-black/40 border border-white/10 rounded-xl px-4 py-3 outline-none focus:border-blue-500 disabled:opacity-50"
                                    }),
                                    React.createElement('button', { 
                                        onClick: askAi,
                                        disabled: aiCooldown || aiLoading,
                                        className: "bg-blue-600 p-3 rounded-xl disabled:opacity-50"
                                    }, aiLoading ? React.createElement('div', { className: "loader" }) : React.createElement(Send, { size: 20 }))
                                )
                            )
                        )
                    ) : (
                        /* DASHBOARD (User/Admin) */
                        !user ? React.createElement('div', { className: "text-center py-20" },
                            React.createElement('h2', { className: "text-2xl font-bold mb-4" }, "Authentication Required"),
                            React.createElement('button', { onClick: handleLogin, className: "bg-white text-black px-8 py-3 rounded-full font-black" }, "LOGIN WITH GOOGLE")
                        ) :
                        user.email === OWNER_EMAIL ? (
                            /* ADMIN VIEW */
                            React.createElement(AdminPanel, { 
                                users: usersList, 
                                config: config, 
                                onUpdateConfig: updateGlobalConfig,
                                onVerifyUser: adminVerifyUser,
                                onBanUser: adminBanUser
                            })
                        ) : (
                            /* STUDENT VIEW */
                            React.createElement('div', { className: "grid md:grid-cols-2 gap-8" },
                                // Profile Card
                                React.createElement('div', { className: "glass p-8 rounded-3xl" },
                                    React.createElement('div', { className: "flex items-center gap-4 mb-8" },
                                        React.createElement('img', { src: user.photoURL, className: "w-16 h-16 rounded-full border-2 border-blue-500" }),
                                        React.createElement('div', null,
                                            React.createElement('h2', { className: "font-bold text-xl" }, profile?.name),
                                            React.createElement('span', { className: `status-badge ${profile?.status === 'Active' ? 'status-active' : 'status-pending'}` }, profile?.status)
                                        )
                                    ),
                                    React.createElement('div', { className: "space-y-4 text-sm" },
                                        React.createElement('div', { className: "flex justify-between p-3 bg-white/5 rounded-xl" },
                                            React.createElement('span', { className: "text-gray-400" }, "Room No"),
                                            React.createElement('span', { className: "font-mono font-bold" }, profile?.room || "Waiting Allocation")
                                        ),
                                        React.createElement('div', { className: "flex justify-between p-3 bg-white/5 rounded-xl" },
                                            React.createElement('span', { className: "text-gray-400" }, "Payment Due"),
                                            React.createElement('span', { className: "font-mono font-bold text-yellow-400" }, profile?.paymentStatus === 'Paid' ? 'â‚¹0' : `â‚¹${config.price}`)
                                        )
                                    )
                                ),
                                // Payment & Actions
                                React.createElement('div', { className: "space-y-6" },
                                    profile?.status !== 'Active' && React.createElement('div', { className: "glass p-8 rounded-3xl border border-yellow-500/30" },
                                        React.createElement('h3', { className: "font-bold text-lg mb-4 flex items-center gap-2" }, React.createElement(AlertTriangle, { className: "text-yellow-500" }), "Action Required"),
                                        React.createElement('p', { className: "text-sm text-gray-400 mb-6" }, "Your seat is reserved but not active. Please complete payment of â‚¹{config.price} and submit the Transaction ID below."),
                                        
                                        React.createElement('div', { className: "space-y-3" },
                                            React.createElement('button', { 
                                                onClick: () => window.location.href = `upi://pay?pa=riteshs9122@ybl&pn=SafaltaExpress&am=${config.price}&cu=INR`,
                                                className: "w-full bg-blue-600 py-3 rounded-xl font-bold flex items-center justify-center gap-2"
                                            }, React.createElement(Smartphone, { size: 16 }), "Pay via UPI App"),
                                            
                                            React.createElement('div', { className: "flex gap-2" },
                                                React.createElement('input', { 
                                                    value: txnId, 
                                                    onChange: (e) => setTxnId(e.target.value),
                                                    placeholder: "Enter UTR / Transaction ID", 
                                                    className: "flex-1 bg-black/40 border border-white/10 rounded-xl px-4 outline-none"
                                                }),
                                                React.createElement('button', { 
                                                    onClick: submitPayment,
                                                    disabled: isVerifying,
                                                    className: "bg-green-600 px-6 rounded-xl font-bold disabled:opacity-50"
                                                }, "Verify")
                                            )
                                        )
                                    ),
                                    React.createElement('div', { className: "glass p-8 rounded-3xl" },
                                        React.createElement('h3', { className: "font-bold mb-4" }, "Community Chat"),
                                        React.createElement('div', { className: "h-40 overflow-y-auto mb-4 space-y-2 pr-2 scrollbar-hide" },
                                            messages.map(m => React.createElement('div', { key: m.id, className: "bg-white/5 p-2 rounded-lg text-xs" },
                                                React.createElement('span', { className: "font-bold text-blue-400" }, m.name, ": "),
                                                m.text
                                            ))
                                        ),
                                        React.createElement('div', { className: "flex gap-2" },
                                            React.createElement('input', { 
                                                value: chatMsg, onChange: (e) => setChatMsg(e.target.value), 
                                                className: "flex-1 bg-white/5 rounded-lg px-3 py-2 text-xs outline-none", 
                                                placeholder: "Say hi..." 
                                            }),
                                            React.createElement('button', { onClick: sendChat, className: "bg-purple-600 p-2 rounded-lg" }, React.createElement(Send, { size: 14 }))
                                        )
                                    )
                                )
                            )
                        )
                    )
                )
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>


